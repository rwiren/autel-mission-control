#############################################################################
# Project: Autel Mission Control
# File: config/mediamtx.yml
# Version: v3.6.0 (Wildcard DVR)
# Date:    2025-12-15
#
# STRATEGY:
# - Use the 'all' wildcard (Like v0.9.1) so the controller ALWAYS connects.
# - Enable Recording on 'all' streams.
# - Use 'fmp4' with 1-hour segments to simulate a Single File (Safe Mode).
#############################################################################

paths:
  # ---------------------------------------------------------
  # WILDCARD PATH (Accepts ANY stream name from Controller)
  # ---------------------------------------------------------
  all:
    # 1. AUTHENTICATION (Open)
    readUser: ""
    readPass: ""
    
    # 2. DVR RECORDING
    record: yes
    
    # Path: recordings/path_name/DATE_TIME
    # Note: %path is dynamic. If drone sends to 'live/rtsp-drone1', it saves there.
    recordPath: ./recordings/%path/%Y-%m-%d_%H-%M-%S
    
    # Format: fmp4 (Crash-proof)
    recordFormat: fmp4
    
    # Duration: 3600s (1 Hour)
    # Result: ONE file per flight (unless you fly > 1 hour).
    recordPartDuration: 3600s
    
    # Keep forever
    recordDeleteAfter: 0s

# ---------------------------------------------
# GLOBAL SETTINGS (Identical to Working v0.9.1)
# ---------------------------------------------
rtsp: yes
rtspAddress: :8554
protocols: [tcp]

rtmp: yes
rtmpAddress: :1935

hls: yes
hlsAddress: :8888
hlsVariant: lowLatency

webrtc: yes
webrtcAddress: :8889
# MANDATORY: The ZeroTier IP of your M4 Max
webrtcAdditionalHosts: [ "192.168.192.61" ]

# ---------------------------------------------
# TUNING (Identical to Working v0.9.1)
# ---------------------------------------------
readTimeout: 20s
writeTimeout: 20s
