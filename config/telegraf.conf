# Telegraf Configuration
# Version: 1.1.0 (Updated for Normalized Topic)

[agent]
  interval = "1s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "1s"
  flush_jitter = "0s"
  debug = false
  quiet = false

# INPUT: Listen to the NEW clean MQTT topic
[[inputs.mqtt_consumer]]
  servers = ["tcp://autel_broker:1883"]
  topics = [
    "telemetry/normalized"
  ]
  qos = 0
  connection_timeout = "30s"
  data_format = "json"
  
  # TAGS: These keys in the JSON become Indexed Tags in InfluxDB
  tag_keys = [
    "device_type",
    "serial",
    "rtk_status"
  ]
  
  # FIELDS: Everything else in the JSON becomes a Field (float/int)
  # (batt, lat, lon, alt, sat_count, heading)

# OUTPUT: Write to InfluxDB
[[outputs.influxdb_v2]]
  urls = ["http://autel_influx:8086"]
  token = "$INFLUX_TOKEN"
  organization = "$INFLUX_ORG"
  bucket = "$INFLUX_BUCKET"
